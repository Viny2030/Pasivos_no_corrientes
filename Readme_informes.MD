# üìÑ M√≥dulo de Generaci√≥n de Informes de Auditor√≠a

## Descripci√≥n

Este m√≥dulo genera autom√°ticamente informes profesionales de auditor√≠a en formato Word (.docx) basados en los an√°lisis algor√≠tmicos realizados sobre el Pasivo No Corriente.

## üéØ Caracter√≠sticas

- **Generaci√≥n autom√°tica**: Crea informes completos a partir de los datos analizados
- **Formato profesional**: Documento Word con estilos consistentes y tablas formateadas
- **Contenido completo**: Incluye:
  - Portada con metadatos
  - Resumen ejecutivo con m√©tricas clave
  - An√°lisis bajo normas nacionales (RT 37, RT 41, Ley 25.506)
  - An√°lisis bajo normas internacionales (ISA 315, ISA 520, COSO)
  - An√°lisis detallado de deudas no corrientes
  - An√°lisis detallado de previsiones
  - Matriz de riesgos y recomendaciones
  - Conclusiones y certificaci√≥n

## üìã Requisitos

### Software necesario

1. **Node.js** (v14 o superior)
   ```bash
   # Verificar instalaci√≥n
   node --version
   ```

2. **Paquete docx**
   ```bash
   npm install -g docx
   ```

3. **Python 3.8+** con pandas

## üöÄ Instalaci√≥n

### Paso 1: Instalar Node.js

**Ubuntu/Debian:**
```bash
curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
sudo apt-get install -y nodejs
```

**macOS:**
```bash
brew install node
```

**Windows:**
Descargar desde [nodejs.org](https://nodejs.org)

### Paso 2: Instalar docx

```bash
npm install -g docx
```

### Paso 3: Verificar instalaci√≥n

```bash
node --version
npm list -g docx
```

## üíª Uso

### Opci√≥n 1: Uso independiente

```bash
# Generar informe con datos de ejemplo
node generar_informe_auditoria.js
```

Esto generar√° el archivo `INFORME_AUDITORIA_PASIVO_NO_CORRIENTE.docx` en el directorio actual.

### Opci√≥n 2: Integraci√≥n con Streamlit

```python
from generador_informe_integracion import GeneradorInformeAuditoria

# Crear generador con tus DataFrames
generador = GeneradorInformeAuditoria(df_deudas, df_previsiones)

# Generar informe
archivo = generador.generar_informe()

if archivo:
    print(f"‚úÖ Informe generado: {archivo}")
```

### Opci√≥n 3: Desde la aplicaci√≥n Streamlit

1. Ejecuta la aplicaci√≥n: `streamlit run pasivo_no_corriente_app.py`
2. Navega a la pesta√±a "Resumen Consolidado"
3. Haz clic en el bot√≥n "üöÄ Generar Informe Word"
4. Descarga el archivo generado

## üìä Estructura del Informe

### 1. Portada
- T√≠tulo del informe
- Fecha de generaci√≥n
- Informaci√≥n del responsable

### 2. Resumen Ejecutivo
- Total del Pasivo No Corriente
- Cantidad de registros analizados
- Anomal√≠as detectadas
- Conclusi√≥n general

### 3. An√°lisis Normativo

#### 3.1 Normas Nacionales (Argentina)
- RT 37 y RT 41 (FACPCE)
- Ley 25.506 (Firma Digital)
- Ley 25.326 (Protecci√≥n de Datos)

#### 3.2 Normas Internacionales
- ISA 315 y 520 (Procedimientos Anal√≠ticos)
- Marco COSO (Control Interno)

### 4. An√°lisis de Deudas No Corrientes
- Resumen general
- Distribuci√≥n por tipo de deuda (tabla)
- Distribuci√≥n por estado (tabla)
- Anomal√≠as detectadas
- Recomendaciones

### 5. An√°lisis de Previsiones
- Resumen general
- Distribuci√≥n por tipo de previsi√≥n (tabla)
- Distribuci√≥n por estado (tabla)
- Anomal√≠as detectadas
- Recomendaciones

### 6. Matriz de Riesgos
- Riesgos identificados
- Impacto potencial
- Probabilidad
- Nivel de riesgo

### 7. Conclusiones
- Certificaci√≥n de cumplimiento
- Recomendaci√≥n final
- Acciones recomendadas

## üé® Personalizaci√≥n

### Modificar la configuraci√≥n del informe

Edita el objeto `CONFIG_INFORME` en `generar_informe_auditoria.js`:

```javascript
const CONFIG_INFORME = {
    titulo: "TU T√çTULO PERSONALIZADO",
    subtitulo: "TU SUBT√çTULO",
    responsable: "Tu Nombre",
    // ...
};
```

### Modificar estilos

Los estilos est√°n definidos en la secci√≥n `styles` del documento:

```javascript
const doc = new Document({
  styles: {
    default: {
      document: {
        run: { font: "Arial", size: 24 }
      }
    },
    // ...
  }
});
```

### Agregar nuevas secciones

Crea una funci√≥n que retorne un array de `Paragraph` objects:

```javascript
function crearNuevaSeccion() {
    return [
        new Paragraph({
            text: "NUEVA SECCI√ìN",
            heading: HeadingLevel.HEADING_1
        }),
        // ... m√°s p√°rrafos
    ];
}
```

Luego agr√©gala en la secci√≥n `children`:

```javascript
children: [
    ...crearPortada(),
    ...crearNuevaSeccion(),  // Tu nueva secci√≥n
    ...crearConclusiones()
]
```

## üìù Formato de Datos

### Estructura esperada para deudas

```python
df_deudas = pd.DataFrame({
    'deuda_id': str,
    'tipo_deuda': str,
    'monto_original': float,
    'saldo_pendiente_simulado': float,
    'estado_deuda': str,
    'is_anomaly': int  # 1 o -1
})
```

### Estructura esperada para previsiones

```python
df_previsiones = pd.DataFrame({
    'id_prevision': str,
    'tipo_prevision': str,
    'monto_estimado_ars': float,
    'estado_actual': str,
    'es_anomalia': int  # 1 o -1
})
```

## üîß Soluci√≥n de Problemas

### Error: "docx is not recognized"

**Soluci√≥n**: Instalar docx globalmente
```bash
npm install -g docx
```

### Error: "Cannot find module 'docx'"

**Soluci√≥n**: Verificar la instalaci√≥n
```bash
npm list -g docx
```

Si no aparece, reinstalar:
```bash
npm uninstall -g docx
npm install -g docx
```

### Error: Archivo no se genera

**Verificar**:
1. Permisos de escritura en el directorio
2. Que Node.js pueda ejecutar scripts
3. Logs de error en la consola

### Tablas no se ven correctamente

**Causa**: Anchos inconsistentes
**Soluci√≥n**: Verificar que `columnWidths` sume exactamente al `width` de la tabla

```javascript
// Incorrecto
columnWidths: [5000, 4000]  // Suma 9000
width: { size: 9360, type: WidthType.DXA }  // No coincide

// Correcto
columnWidths: [5000, 4360]  // Suma 9360
width: { size: 9360, type: WidthType.DXA }  // Coincide
```

## üìñ Ejemplos Adicionales

### Ejemplo 1: Informe con datos personalizados

```javascript
// Modificar DATOS_ANALISIS en generar_informe_auditoria.js
const DATOS_ANALISIS = {
    deudas: {
        total: 50,
        montoOriginal: 250000000.00,
        // ... tus datos
    }
};
```

### Ejemplo 2: Cambiar formato de fecha

```javascript
const CONFIG_INFORME = {
    fecha: new Date().toLocaleDateString('es-AR', { 
        year: 'numeric', 
        month: 'long', 
        day: 'numeric',
        weekday: 'long'  // Agregar d√≠a de la semana
    })
};
```

### Ejemplo 3: Agregar logo

```javascript
// Agregar en la portada
new Paragraph({
    children: [new ImageRun({
        type: "png",
        data: fs.readFileSync("logo.png"),
        transformation: { width: 200, height: 100 }
    })],
    alignment: AlignmentType.CENTER
})
```

## üéì Referencias

- [Documentaci√≥n de docx-js](https://docx.js.org/)
- [RT 37 FACPCE](https://www.facpce.org.ar)
- [Normas Internacionales de Auditor√≠a](https://www.ifac.org/isa)

## ü§ù Contribuciones

Para agregar nuevas funcionalidades:

1. Crear nueva funci√≥n de secci√≥n
2. Agregar a la secuencia de `children`
3. Probar la generaci√≥n
4. Validar el documento con `python scripts/office/validate.py`

## üìû Soporte

Para problemas o consultas:
- Revisar la secci√≥n de Soluci√≥n de Problemas
- Verificar logs de Node.js
- Consultar documentaci√≥n de docx-js

---

**Versi√≥n**: 1.0.0  
**√öltima actualizaci√≥n**: Febrero 2026  
**Compatibilidad**: Node.js 14+, Python 3.8+